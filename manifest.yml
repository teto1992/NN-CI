name: pipeline-demo
description:
tags:
initialize:
  plugins:
    nn-et:
      path: 'if-plugin-nnci'
      method: NNET
      global-config:
        input-parameters:
          {
            'hardware/count/training': 'hardware/training',
            'hardware/power/training': 'power/hardware-training',
            'servers/count/training': 'servers/training',
            'servers/power/training': 'power/servers-training',
            'time/training': 'time/training',
            'pue/training': 'pue/training',
          }
        output-parameter: 'energy-consumed-by-training-NN'
    nn-eq:
      path: 'if-plugin-nnci'
      method: NNEQ
      global-config:
        input-parameters:
          {
            'servers/count/query': 'servers/query',
            'servers/power/query': 'power/query',
            'time/query': 'time/query',
            'pue/query': 'pue/query',
          }
        output-parameter: 'energy-consumed-by-query-NN'
    nn-emb:
      path: 'if-plugin-nnci'
      method: NNEmb
      global-config:
        input-parameters:
          {
            list/device-count:
              ['hardware/training', 'servers/training', 'servers/query'],
            list/device-production-energy:
              [
                'hardware-training-production-energy',
                'servers-training-production-energy',
                'server-query-production-energy',
              ],
            list/carbon-intensity:
              [
                'carbon-intensity/training',
                'carbon-intensity/training',
                'carbon-intensity/query',
              ],
            list/energy-transport:
              [
                'energy-transport-factor/training',
                'energy-transport-factor/training',
                'energy-transport-factor/query',
              ],
          }
        output-parameter: 'embodied-carbon-of-NN'
    nn-c:
      path: 'if-plugin-nnci'
      method: NNC
      global-config:
        input-parameters:
          {
            location/datacenter-energy:
              ['energy-consumed-by-training-NN', 'energy-consumed-by-query-NN'],
            location/carbon-intensity:
              ['carbon-intensity/training', 'carbon-intensity/query'],
            location/energy-transport:
              [
                'energy-transport-factor/training',
                'energy-transport-factor/query',
              ],
          }
        output-parameter: 'carbon-emission-by-NN'
    sum:
      path: '@grnsft/if-plugins'
      method: Sum
      global-config:
        input-parameters: ['embodied-carbon-of-NN', 'carbon-emission-by-NN']
        output-parameter: 'total-carbon-emission-by-NN'
tree:
  children:
    child-1:
      pipeline:
        - nn-et
        - nn-eq
        - nn-emb
        - nn-c
        - sum
      inputs:
        - timestamp: '2023-12-12T00:00:00.000Z'
          servers/query: 3620
          server-query-production-energy: 750
          time/query: 24
          pue/query: 1.1
          power/query: 250
          hardware/training: 10000
          hardware-training-production-energy: 1000
          servers/training: 625
          servers-training-production-energy: 900
          time/training: 360
          pue/training: 1.1
          power/hardware-training: 300
          power/servers-training: 250
          carbon-intensity/training: 0.429
          carbon-intensity/query: 0.429
          energy-transport-factor/training: 0.95
          energy-transport-factor/query: 0.95
